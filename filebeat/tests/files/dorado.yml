#=========================== Filebeat prospectors =============================

filebeat.prospectors:
- type: log
  enabled: false
  paths:
  - /usr/dorado/logs/restapi.log
  
  multiline.pattern: '^<[0-9]{4}-[0-9]{2}-[0-9]{2}'
  multiline.negate: true
  multiline.match: after
  
  fields:
    container_type: dorado
    log_type: api

- type: log
  enabled: true
  paths:
  - /usr/dorado/logs/tomcat.log

  #include_lines: ['<ERROR', 'json_extract_prefix']
  json_extract.add_error_key: true
    
  multiline.pattern: '^<[0-9]{4}-[0-9]{2}-[0-9]{2}'
  multiline.negate: true
  multiline.match: after
  
  fields:
    container_type: dorado
    log_type: tomcat

- type: log
  enabled: true
  paths:
  - /usr/dorado/logs/conference_cdr.log

  #include_lines: ['<ERROR', 'json_extract_prefix']
  json_extract.add_error_key: true

  multiline.pattern: '^<[0-9]{4}-[0-9]{2}-[0-9]{2}'
  multiline.negate: true
  multiline.match: after

  fields:
    container_type: dorado
    log_type: audit
      
#================================ General =====================================

processors:

  - decode_json_fields:
      fields: ["json_extract"]
      max_depth: 20
      process_array: true

  - drop_fields:
      fields: ["beat.name", "beat.version"] 
      
#================================ Outputs =====================================

#----------------------------- Logstash output --------------------------------
output.logstash:
  # The Logstash hosts
  hosts: ["logstash:5044"]
